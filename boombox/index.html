<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body></body>
  <script type="text/javascript">
    const AudioContext = window.AudioContext || window.webkitAudioContext;
    const audioCtx = new AudioContext();
    const listener = audioCtx.listener;

    const posX = window.innerWidth / 2;
    const posY = window.innerHeight / 2;
    const posZ = 300;

    listener.positionX.value = posX;
    listener.positionY.value = posY;
    listener.positionZ.value = posZ - 5;

    listener.forwardX.value = 0;
    listener.forwardY.value = 0;
    listener.forwardZ.value = -1;
    listener.upX.value = 0;
    listener.upY.value = 1;
    listener.upZ.value = 0;

    const pannerModel = "HRTF";
    const innerCone = 60;
    const outterCone = 90;
    const outterGain = 0.3;

    const distanceModel = "linear";
    const maxDistance = 10_000;

    const refDistance = 1;
    const rollOff = 10;

    const positionX = posX;
    const positionY = posY;
    const positionZ = posZ;

    const orientationX = 0.0;
    const orientationY = 0.0;
    const orientationZ = -1.0;

    const panner = new PannerNode(audioCtx, {
      panningModel: pannerModel,
      distanceModel: distanceModel,
      positionX: positionX,
      positionY: positionY,
      positionZ: positionZ,
      orientationX: orientationX,
      orientationY: orientationY,
      orientationZ: orientationZ,
      refDistance: refDistance,
      maxDistance: maxDistance,
      rolloffFactor: rollOff,
      coneInnerAngle: innerCone,
      coneOuterAngle: outterCone,
      coneOuterGain: outterGain,
    });

    // get the audio element
    const audioElement = document.querySelector("audio");
    // pass it into the audio context
    const track = audioContext.createMediaElementSource(audioElement);

    tack.connect(panner).connect(audioCtx.destination);

    const playButton = document.querySelector("a-sphere");

    playButton.addEventListener(
      "click",
      function () {
        // check if context is in suspended state (autoplay policy)
        if (audioContext.state === "suspended") {
          audioContext.resume();
        }

        // play or pause track depending on state
        if (this.dataset.playing === "false") {
          audioElement.play();
          this.dataset.playing = "true";
        } else if (this.dataset.playing === "true") {
          audioElement.pause();
          this.dataset.playing = "false";
        }
      },
      false
    );
  </script>
</html>
